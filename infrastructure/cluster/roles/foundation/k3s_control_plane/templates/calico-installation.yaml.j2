---
# Calico Installation for K3s
# This file is generated by Ansible - DO NOT EDIT MANUALLY
apiVersion: operator.tigera.io/v1
kind: Installation
metadata:
  name: default
spec:
  # Configure Calico for K3s environment
  kubernetesProvider: ""
  
  # Calico version - upgrade to v3.30.2 to fix pod-to-API connectivity
  variant: Calico
  calicoVersion: v3.30.2
  
  # Network configuration
  calicoNetwork:
    # Configure IP pools
    ipPools:
    - blockSize: 26
      cidr: {{ calico_ipv4pool_cidr }}
      encapsulation: VXLAN
      natOutgoing: Enabled
      nodeSelector: all()
    
    # Container settings
    containerIPForwarding: Enabled
    
    # Host ports configuration  
    hostPorts: Enabled
    
    # Multi-interface mode for pod networking
    multiInterfaceMode: None

  # Node configuration  
  nodeAddressAutodetection:
    # Auto-detect the correct interface
    firstFound: true

  # Flexvolume path for K3s
  flexVolumePath: /var/lib/kubelet/volumeplugins

  # Registry configuration - use Quay.io to avoid Docker Hub rate limits
  registry: quay.io

---
# Calico API Server (optional but recommended for NetworkPolicy)
apiVersion: operator.tigera.io/v1
kind: APIServer
metadata:
  name: default
spec: {}
