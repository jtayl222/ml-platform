---
- name: Create Istio installation directory
  file:
    path: "{{ istio_install_dir }}"
    state: directory
    mode: '0755'
  delegate_to: "{{ control_plane_host }}"
  become: true
  tags: [istio, istioctl]

- name: Install istioctl
  include_tasks: install-istioctl.yml
  tags: [istio, istioctl]

- name: Deploy Istio using istioctl
  include_tasks: deploy-istio.yml
  tags: [istio, deploy]

- name: Deploy Kiali for Istio observability
  include_tasks: deploy-kiali.yml
  when: kiali_enabled
  tags: [istio, kiali]

- name: Configure platform-specific settings
  include_tasks: configure-platform.yml
  tags: [istio, platform]